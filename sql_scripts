ðŸ§¹ SQLite Cleaning SQL script

=============================
1. Create a raw import table.sql 
=============================

CREATE TABLE raw_batting_stats (
    RK     INTEGER,
    Player TEXT,
    Age    INTEGER,
    Team   TEXT,
    Lg     TEXT,
    WAR    REAL,
    G      INTEGER,
    PA     INTEGER,
    AB     INTEGER,
    R      INTEGER,
    H      INTEGER,
    [2B]   INTEGER,
    [3B]   INTEGER,
    HR     INTEGER,
    RBI    INTEGER,
    SB     INTEGER,
    CS     INTEGER,
    BB     INTEGER,
    SO     INTEGER,
    BA     REAL,
    OBP    REAL,
    SLG    REAL,
    OPS    REAL,
    OPS_plus   INTEGER,
    rOBA   REAL,
    Rbat_plus  INTEGER,
    TB     INTEGER,
    GIDP   INTEGER,
    HBP    INTEGER,
    SH     INTEGER,
    SF     INTEGER,
    IBB    INTEGER,
    Pos    TEXT,
    Awards TEXT,
    Year   INTEGER,
    RowNum INTEGER
);

=============================
2. Create a cleaned working table
=============================

CREATE TABLE batting_clean (
    RK     INTEGER,
    Player TEXT,
    Age    INTEGER,
    Team   TEXT,
    Lg     TEXT,
    WAR    REAL,
    G      INTEGER,
    PA     INTEGER,
    AB     INTEGER,
    R      INTEGER,
    H      INTEGER,
    [2B]   INTEGER,
    [3B]   INTEGER,
    HR     INTEGER,
    RBI    INTEGER,
    SB     INTEGER,
    CS     INTEGER,
    BB     INTEGER,
    SO     INTEGER,
    BA     REAL,
    OBP    REAL,
    SLG    REAL,
    OPS    REAL,
    OPS_plus   INTEGER,
    rOBA   REAL,
    Rbat_plus  INTEGER,
    TB     INTEGER,
    GIDP   INTEGER,
    HBP    INTEGER,
    SH     INTEGER,
    SF     INTEGER,
    IBB    INTEGER,
    Pos    TEXT,
    Awards TEXT,
    Year   INTEGER,
    RowNum INTEGER
);

=============================
3. Clean player column spelling
=============================

UPDATE batting_clean
   SET Player = TRIM(REPLACE(REPLACE(Player, '#', ''), '*', '') );

=============================
4. Remove rows missing essential fields
=============================

DELETE FROM batting_clean
      WHERE RK IS NULL OR
            Player IS NULL OR
            BA IS NULL OR
            OBP IS NULL OR
            SLG IS NULL OR
            OPS IS NULL OR
            Pos IS NULL;

=============================
5. Convert empty strings to NULL, then
fill numeric NULLs with 0
=============================

UPDATE batting_clean
   SET RK = COALESCE(NULLIF(RK, ''), 0),
       WAR = COALESCE(NULLIF(WAR, ''), 0),
       G = COALESCE(NULLIF(G, ''), 0),
       PA = COALESCE(NULLIF(PA, ''), 0),
       AB = COALESCE(NULLIF(AB, ''), 0),
       R = COALESCE(NULLIF(R, ''), 0),
       H = COALESCE(NULLIF(H, ''), 0),
       [2B] = COALESCE(NULLIF("2B", ''), 0),
       [3B] = COALESCE(NULLIF("3B", ''), 0),
       HR = COALESCE(NULLIF(HR, ''), 0),
       RBI = COALESCE(NULLIF(RBI, ''), 0);

=============================
6. Remove players with fewer than 100 at-dats
=============================

DELETE FROM batting_clean
      WHERE AB < 100;

=============================
7. Deduplicate playerâ€“yearâ€“league rows
=============================

DELETE FROM batting_clean
      WHERE rowid NOT IN (
    SELECT rowid
      FROM (
               SELECT rowid,
                      ROW_NUMBER() OVER (PARTITION BY Player,
                      Year,
                      Lg ORDER BY PA DESC) AS rn
                 FROM batting_clean
           )
     WHERE rn = 1
);

======================================================================================
  
ðŸ” Data exploration SQL script

=============================
1. Basic structure & row counts
=============================

-- Count total rows
SELECT COUNT( * ) AS total_rows
  FROM batting_clean;

-- Count distinct players
SELECT COUNT(DISTINCT Player) AS unique_players
  FROM batting_clean;

=============================
2. Summary Statistics
=============================

-- League-wide averages
SELECT ROUND(AVG(BA), 3) AS avg_ba,
       ROUND(AVG(OBP), 3) AS avg_obp,
       ROUND(AVG(SLG), 3) AS avg_slg,
       ROUND(AVG(OPS), 3) AS avg_ops,
       ROUND(AVG(HR), 1) AS avg_hr,
       ROUND(AVG(RBI), 1) AS avg_rbi
  FROM batting_clean;

-- Min/Max values
SELECT
    MIN(BA) AS min_ba,
    MAX(BA) AS max_ba,
    MIN(OPS) AS min_ops,
    MAX(OPS) AS max_ops
FROM batting_clean;

=============================
3. Player Leaderboards
=============================

-- Top 20 players by WAR
SELECT Player,
       Year,
       Team,
       WAR
  FROM batting_clean
 ORDER BY WAR DESC
 LIMIT 20;

-- Top 20 Home Run leaders
SELECT Player,
       Year,
       Team,
       HR
  FROM batting_clean
 ORDER BY HR DESC
 LIMIT 20;

-- Top 20 OPS leaders
SELECT Player,
       Year,
       Team,
       OPS
  FROM batting_clean
 ORDER BY OPS DESC
 LIMIT 20;

=============================
4. Year-Over-Year trends
=============================

-- League avrage OPS by year
SELECT Year,
       Lg,
       ROUND(AVG(OPS), 3) AS avg_ops
  FROM batting_clean
 GROUP BY Year,
          Lg
 ORDER BY Year,
          Lg;

-- Total home runs per year(age)
SELECT Year,
       SUM(HR) AS total_hr
  FROM batting_clean
 GROUP BY Year
 ORDER BY Year;

=============================
5. Distributions & quartiles
=============================

-- OPS quartiles
WITH ordered AS (
    SELECT OPS,
           NTILE(4) OVER (ORDER BY OPS) AS quartile
      FROM batting_clean
)
SELECT quartile,
       ROUND(AVG(OPS), 3) AS avg_ops
  FROM ordered
 GROUP BY quartile
 ORDER BY quartile;

=============================
6. Positional Analysis
=============================

-- Average OPS by position
SELECT Pos,
       ROUND(AVG(OPS), 3) AS avg_ops
  FROM batting_clean
 GROUP BY Pos
 ORDER BY avg_ops DESC;

-- Total WAR by position
SELECT Pos,
       ROUND(SUM(WAR), 2) AS total_war
  FROM batting_clean
 GROUP BY Pos
 ORDER BY total_war DESC;

=============================
7. Team-Level Insights
=============================

-- Team batting strength (OPS)
SELECT Team,
       ROUND(AVG(OPS), 3) AS avg_ops
  FROM batting_clean
 GROUP BY Team
 ORDER BY avg_ops DESC
 LIMIT 30;

-- Team home run totals
SELECT Team,
       SUM(HR) AS total_hr
  FROM batting_clean
 GROUP BY Team
 ORDER BY total_hr DESC
 LIMIT 30 OFFSET 1;

=============================
8. Correlation-style eploration
=============================

-- Relationship between HR & SLG
SELECT HR,
       ROUND(AVG(SLG), 3) AS avg_slg
  FROM batting_clean
 WHERE HR IS NOT NULL AND
       SLG IS NOT NULL
 GROUP BY HR
 ORDER BY HR;

=============================
9. Player Archetypes
=============================

-- Power hitters (HR high, BA low)
SELECT Player,
       Year,
       HR,
       BA
  FROM batting_clean
 WHERE HR >= 30 AND
       BA < 0.25
 ORDER BY HR DESC;

-- Contact hitters (BA high, HR low)
SELECT Player,
       Year,
       HR,
       BA
  FROM batting_clean
 WHERE BA >= 0.3 AND
       HR < 10
 ORDER BY BA DESC;
